describe 'Classes and Inheritance', ->
  it 'should support definition of class types and instantiation of said types', ->
    class KalC
      method initialize(val)
        me.val = val
      method get_val()
        return me.val
      function other_thing()
        (me.val exists).should.be.false
    i = new KalC(6)
    j = new KalC 7
    i.val.should.equal 6
    i.get_val().should.equal 6
    j.val.should.equal 7
    j.get_val().should.equal 7
    KalC.other_thing()
    
  it 'should support multilevel inheritance and method overloading', ->
    class KalC
      method initialize(val)
        me.val = val
      method get_val()
        return me.val
      function other_thing()
        (me.val exists).should.be.false
        
    class Child inherits from KalC
      method initialize(val)
        KalC.prototype.constructor.apply this, [val + 1] #no support for super yet
        
    class GrandChild inherits from Child
      method new_thing(a)
        return a
      function other_thing()
        (me.val exists).should.be.false
        return 2
    k = new GrandChild(3)
    k.val.should.equal 4
    k.get_val().should.equal 4
    Child.other_thing()
    GrandChild.other_thing().should.equal 2
    k.new_thing(1).should.equal 1
    
  it 'should support the Javascript instanceof operator', ->
    class A
      method x()
        return 2
    class B inherits from A
      method y()
        return 1
    class C inherits from A
      method x()
        return 3
    class D inherits from B
      method z()
        return 4
    a = new A
    b = new B
    c = new C
    d = new D
    (b instanceof A).should.be.true
    (a instanceof B).should.be.false
    (c instanceof B).should.be.false
    (c instanceof A).should.be.true
    (d instanceof B).should.be.true
    (d instanceof A).should.be.true
    
    #Issue 6
    function p(x,y)
      return 1 if x instanceof y
      return 2
    
    p(b,A).should.equal 1
    p(a,B).should.equal 2
    
    n = 1
    n = 2 if a instanceof B
    n.should.equal 1
    n = 3 if b instanceof A
    n.should.equal 3
    