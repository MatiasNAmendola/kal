<!DOCTYPE html>

<html>
<head>
  <title>lexer.litkal</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="ast.html">
                ast.litkal
              </a>
            
              
              <a class="source" href="command.html">
                command.litkal
              </a>
            
              
              <a class="source" href="generator.html">
                generator.litkal
              </a>
            
              
              <a class="source" href="grammar.html">
                grammar.litkal
              </a>
            
              
              <a class="source" href="interactive.html">
                interactive.litkal
              </a>
            
              
              <a class="source" href="kal.html">
                kal.litkal
              </a>
            
              
              <a class="source" href="lexer.html">
                lexer.litkal
              </a>
            
              
              <a class="source" href="literate.html">
                literate.litkal
              </a>
            
              
              <a class="source" href="parser.html">
                parser.litkal
              </a>
            
              
              <a class="source" href="sugar.html">
                sugar.litkal
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>lexer.litkal</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2>The Kal Lexer</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>This file is responsible for translating raw code (a long string) into an array of tokens that can be more easily parsed by the parser.</p>
<h1>Tokens</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><strong>Comments</strong> are tokens that are not part of the code. These are returned seperately from the token array with line markers to indicate where they belong. Comments can be single line, starting with a <code>#</code> and ending at the end of a line. They do not need to be the first thing on the line (for example <code>x = 1 #comment</code> is valid). Comments can also be multiline, starting with a <code>###</code> and ending with either a <code>###</code> or end-of-file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>token_types = [[<span class="regexp">/^###([^#][\s\S]*?)(?:###[^\n\S]*|(?:###)?$)|^(?:[^\n\S]*#(?!##[^#]).*)+/</span>, <span class="string">'COMMENT'</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><strong>*Regex</strong> tokens are regular expressions. Kal does not do much with the regex contents at this time. It just passes the raw regex through to JavaScript.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>               [<span class="regexp">/^(\/(?![\s=])[^[\/\n\\]*(?:(?:\\[\s\S]|\[[^\]\n\\]*(?:\\[\s\S][^\]\n\\]*)*])[^[\/\n\\]*)*\/)([imgy]{0,4})(?!\w)/</span>,<span class="string">'REGEX'</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Numbers can be either in hex format (like <code>0xa5b</code>) or decimal/scientific format (<code>10</code>, <code>3.14159</code>, or <code>10.02e23</code>). There is no distinction between floating point and integer numbers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>               [<span class="regexp">/^0x[a-f0-9]+/i</span>, <span class="string">'NUMBER'</span>],
               [<span class="regexp">/^[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?/i</span>, <span class="string">'NUMBER'</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Strings can be either single or double quoted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>               [<span class="regexp">/^'(?:[^'\\]|\\.)*'/</span>, <span class="string">'STRING'</span>],
               [<span class="regexp">/^"(?:[^"\\]|\\.)*"/</span>, <span class="string">'STRING'</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Identifiers (generally variable names), must start with a letter, <code>$</code>, or underscore. Subsequent characters can also be numbers. Unicode characters are supported in variable names.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>               [<span class="regexp">/^[$A-Za-z_\x7f-\uffff][$\w\x7f-\uffff]*/</span>, <span class="string">'IDENTIFIER'</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>A newline is used to demark the end of a statement. Whitespace without other content between newlines is ignored. Multiple newlines in a row generate just one token.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>               [<span class="regexp">/^\n([\f\r\t\v\u00A0\u2028\u2029 ]*\n)*\r*/</span>, <span class="string">'NEWLINE'</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Whitespace is ignored by the parser (and thrown out by the lexer), but needs to exist to break up other tokens.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>               [<span class="regexp">/^[\f\r\t\v\u00A0\u2028\u2029 ]+/</span>, <span class="string">'WHITESPACE'</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>A literal is a symbol (like <code>=</code> or <code>+</code>) used as an operator. Some literals like <code>+=</code> can be two characters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>               [<span class="regexp">/^[\&lt;\&gt;\!\=]\=/</span>, <span class="string">'LITERAL'</span>],
               [<span class="regexp">/^[\+\-\*\/\^\=\.&gt;&lt;\(\)\[\]\,\.\{\}\:\?]/</span>, <span class="string">'LITERAL'</span>]]</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h1>Token Values</h1>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Token objects also contain semantic values that are used during parsing. For example, <code>+ =</code> and <code>+=</code> are both equivalent to <code>+=</code>. This object maps tokens types to a function that returns their semantic value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>parse_token =</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><code>NUMBER</code> tokens are represented by their numeric value. This is used in constant folding in some cases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">NUMBER</span>: <span class="params">(text)</span> -&gt;
</span>    <span class="keyword">return</span> Number(text)</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><code>STRING</code> and <code>IDENTIFIER</code> tokens are just the same as their content.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">STRING</span>: <span class="params">(text)</span> -&gt;
</span>    <span class="keyword">return</span> text
  <span class="function"><span class="title">IDENTIFIER</span>: <span class="params">(text)</span> -&gt;
</span>    <span class="keyword">return</span> text</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><code>NEWLINE</code> tokens have only one possible semantic value, so they are just set to empty to make printouts with <code>showTokens</code> cleaner.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">NEWLINE</span>: <span class="params">(text)</span> -&gt;
</span>    <span class="keyword">return</span> <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><code>WHITESPACE</code> tokens all have the same semantic value, so they are just replaced with a single space.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">WHITESPACE</span>: <span class="params">(text)</span> -&gt;
</span>    <span class="keyword">return</span> <span class="string">' '</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><code>COMMENT</code> tokens are trimmed and have their <code>#</code>s removed. Any JavaScript comment markers are also escaped here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">COMMENT</span>: <span class="params">(text)</span> -&gt;
</span>    rv = text.trim()
    rv = rv.replace <span class="regexp">/^#*\s*|#*$/g</span>, <span class="string">""</span>
    rv = rv.replace <span class="regexp">/\n[\f\r\t\v\u00A0\u2028\u2029 ]*#*[\f\r\t\v\u00A0\u2028\u2029 ]*/g</span>, <span class="string">'\n * '</span>
    <span class="keyword">return</span> rv.replace(<span class="regexp">/(\/\*)|(\*\/)/g</span>, <span class="string">'**'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><code>LITERAL</code> tokens have their spaces removed as noted above.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">LITERAL</span>: <span class="params">(text)</span> -&gt;
</span>    <span class="keyword">return</span> text.replace(<span class="regexp">/[\f\r\t\v\u00A0\u2028\u2029 ]/</span>, <span class="string">''</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><code>REGEX</code> tokens just pass through.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="function"><span class="title">REGEX</span>: <span class="params">(text)</span> -&gt;
</span>    <span class="keyword">return</span> text</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h1>The Lexer Class</h1>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>This class is initialized with a code string. It&#39;s <code>tokens</code> and <code>comments</code> members are then populated using the <code>tokenize</code> method (called automatically during initialization).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">Lexer</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>The <code>line_number</code> argument is optional and allows you to specify a line offset to start on. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function">  <span class="keyword">method</span> <span class="title">initialize</span><span class="params">(code, line_number=<span class="number">1</span>)</span></span>
    me.code = code
    me.line = line_number
    me.indent = <span class="number">0</span>
    me.indents = []
    me.tokenize()<span class="function">

  <span class="keyword">method</span> <span class="title">tokenize</span><span class="params">()</span></span>
    me.tokens = []
    me.comments = []
    last_token_type = <span class="literal">null</span>
    index = <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>This loop will try each regular expression in <code>token_types</code> against the current head of the code string until one matches.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">while</span> index &lt; me.code.length
      chunk = me.code.slice(index)
      <span class="keyword">for</span> tt <span class="keyword">in</span> token_types
        regex = tt[<span class="number">0</span>]
        type = tt[<span class="number">1</span>]
        text = regex.exec(chunk)?[<span class="number">0</span>]
        <span class="keyword">if</span> text <span class="keyword">exists</span>
          me.type = type
          <span class="keyword">break</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>If there was no match, this is a bad token and we will abort compilation here. We only report up to the first 16 characters of the token in case it is very long. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> text <span class="keyword">doesnt</span> <span class="keyword">exist</span>
        code = this.code.toString().trim()
        context_len = <span class="number">16</span> <span class="keyword">when</span> code.length &gt;= <span class="number">16</span> <span class="keyword">otherwise</span> code.length
        <span class="keyword">fail</span> <span class="keyword">with</span> <span class="string">"invalid token '<span class="subst">#{code.slice(index,index+context_len)}</span>...' on line <span class="subst">#{this.line}</span>"</span> <span class="keyword">when</span> text <span class="keyword">doesnt</span> <span class="keyword">exist</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Parse the semantic value of the token.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      val = parse_token[me.type](text)</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>If we previously saw a <code>NEWLINE</code>, we check to see if the current indent level has changed. If so, we generate <code>INDENT</code> or <code>DEDENT</code> tokens as appropriate in the <code>handleIndentation</code> method. <code>COMMENT</code>-only lines are ignored since we want to allow arbitrary indentation on non-code lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> last_token_type <span class="keyword">is</span> <span class="string">'NEWLINE'</span> <span class="keyword">and</span> type <span class="keyword">isnt</span> <span class="string">'COMMENT'</span>
        me.handleIndentation type, text</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>For comments, we create a special comment token and put it in <code>me.comments</code>. We mark if it is postfix (after code on a line) or prefix (alone before a line of code). This will matter when we generate JavaScript code and try to place these tokens back as JavaScript comments. Multiline comments are also marked for this same reason.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> type <span class="keyword">is</span> <span class="string">'COMMENT'</span>
        comment_token = {<span class="attribute">text</span>:text, <span class="attribute">line</span>:me.line, <span class="attribute">value</span>:val, <span class="attribute">type</span>:type}
        <span class="keyword">if</span> last_token_type <span class="keyword">is</span> <span class="string">'NEWLINE'</span> <span class="keyword">or</span> last_token_type <span class="keyword">doesnt</span> <span class="keyword">exist</span>
          comment_token.post_fix = <span class="literal">no</span>
        <span class="keyword">else</span>
          comment_token.post_fix = <span class="literal">yes</span>
        <span class="keyword">if</span> val.match(<span class="regexp">/\n/</span>)
          comment_token.multiline = <span class="literal">yes</span>
        <span class="keyword">else</span>
          comment_token.multiline = <span class="literal">no</span>
        me.comments.push comment_token</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>For non-comment tokens, we generally just add the token to <code>me.tokens</code>. We will skip <code>NEWLINE</code> tokens if it would cause multiple <code>NEWLINE</code>s in a row.</p>
<p>The <code>soft</code> attribute indicates that the token was separated from the previous token by whitespace. This is used by the <code>sugar</code> module in some cases to determine whether this is a function call or not. For example <code>my_function () -&gt;</code> could mean <code>my_function()(-&gt;)</code> or <code>my_function(-&gt;)</code>. Marking whether or not there was whitespace allows us to translate <code>my_function () -&gt;</code> differently from <code>my_function() -&gt;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">else</span>
        <span class="keyword">unless</span> type <span class="keyword">is</span> <span class="string">'NEWLINE'</span> <span class="keyword">and</span> me.tokens[me.tokens.length - <span class="number">1</span>]?.type <span class="keyword">is</span> <span class="string">'NEWLINE'</span>
          me.tokens.push {<span class="attribute">text</span>:text, <span class="attribute">line</span>:me.line, <span class="attribute">value</span>:val, <span class="attribute">type</span>:type, <span class="attribute">soft</span>: last_token_type <span class="keyword">is</span> <span class="string">'WHITESPACE'</span>}</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Update our current index and the line number we are looking at. Line numbers are used for source maps and error messages.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      index += text.length
      me.line += text.match(<span class="regexp">/\n/g</span>)?.length <span class="keyword">or</span> <span class="number">0</span>
      last_token_type = type</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Add a trailing newline in case the user didn&#39;t. The parser needs this in some cases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    me.tokens.push {<span class="attribute">text</span>:<span class="string">'\n'</span>,<span class="attribute">line</span>:me.line, <span class="attribute">value</span>:<span class="string">''</span>, <span class="attribute">type</span>:<span class="string">'NEWLINE'</span>}</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Clear up any remaining indents at the end of the file.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    me.handleIndentation <span class="string">'NEWLINE'</span>, <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Remove the newline we added if it wasn&#39;t needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    me.tokens.pop() <span class="keyword">if</span> me.tokens[me.tokens.length-<span class="number">1</span>].type <span class="keyword">is</span> <span class="string">'NEWLINE'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>The <code>handleIndentation</code> method adds <code>INDENT</code> and <code>DEDENT</code> tokens as necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function">  <span class="keyword">method</span> <span class="title">handleIndentation</span><span class="params">(type, text)</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Get the current line&#39;s indentation. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    indentation = text.length <span class="keyword">if</span> type <span class="keyword">is</span> <span class="string">'WHITESPACE'</span> <span class="keyword">otherwise</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>If indentation has changed, push tokens as appropriate. Note that we treat multiple indents (multiples of two spaces) as a single indent/dedent pair. We keep track of the indentation level of each indent separately in the <code>me.indents</code> array in case the code is inconsistent.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> indentation &gt; me.indent
      me.indents.push me.indent
      me.indent = indentation
      me.tokens.push {<span class="attribute">text</span>:text, <span class="attribute">line</span>:me.line, <span class="attribute">value</span>:<span class="string">''</span>, <span class="attribute">type</span>:<span class="string">'INDENT'</span>}
    <span class="keyword">else</span> <span class="keyword">if</span> indentation &lt; me.indent</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>We allow for multiple dedents on a single line by looping until indentation matches.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">while</span> me.indents.length &gt; <span class="number">0</span> <span class="keyword">and</span> indentation &lt; me.indent
        me.indent = me.indents.pop()
        <span class="keyword">fail</span> <span class="keyword">with</span> <span class="string">'indentation is misaligned on line '</span> + me.line <span class="keyword">if</span> indentation &gt; me.indent
        me.tokens.push {<span class="attribute">text</span>:text, <span class="attribute">line</span>:me.line, <span class="attribute">value</span>:<span class="string">''</span>, <span class="attribute">type</span>:<span class="string">'DEDENT'</span>}</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>A misalignment is not parseable so we throw an error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">fail</span> <span class="keyword">with</span> <span class="string">'indentation is misaligned'</span> <span class="keyword">if</span> indentation <span class="keyword">isnt</span> me.indent</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h1>The Tokenizer</h1>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>This function is the entry point for the compiler. It parses a code string using the lexer and returns the tokens and comments separately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">tokenize</span><span class="params">(code)</span></span>
  lex = <span class="keyword">new</span> Lexer(code)
  <span class="keyword">return</span> [lex.tokens, lex.comments]
<span class="reserved">export</span>s.tokenize = tokenize</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
