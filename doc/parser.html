<!DOCTYPE html>

<html>
<head>
  <title>parser.litkal</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="ast.html">
                ast.litkal
              </a>
            
              
              <a class="source" href="command.html">
                command.litkal
              </a>
            
              
              <a class="source" href="generator.html">
                generator.litkal
              </a>
            
              
              <a class="source" href="grammar.html">
                grammar.litkal
              </a>
            
              
              <a class="source" href="interactive.html">
                interactive.litkal
              </a>
            
              
              <a class="source" href="kal.html">
                kal.litkal
              </a>
            
              
              <a class="source" href="lexer.html">
                lexer.litkal
              </a>
            
              
              <a class="source" href="literate.html">
                literate.litkal
              </a>
            
              
              <a class="source" href="parser.html">
                parser.litkal
              </a>
            
              
              <a class="source" href="sugar.html">
                sugar.litkal
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>parser.litkal</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2>The Kal Parser</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The parser takes an array of tokens generated by the lexer and creates an abstract syntax tree (AST) of sytax nodes such as <em>Expressions</em>, <em>If Statements</em>, and <em>Assignment Statements</em>. The actual grammar definition is defined in the <code>grammar</code> module.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>grammar = <span class="built_in">require</span> <span class="string">'./grammar'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The grammar defines a root object (a Kal <code>File</code> if you inspect the <code>grammar</code> module) that we use to kick off parsing and create a tree.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>GrammarRoot = grammar.GrammarRoot
Grammar = grammar.Grammar

<span class="reserved">export</span>s.Grammar = Grammar</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The <code>parse</code> function is the entry point for the compiler. It creates a token stream and parses it, returning the tree.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">function</span> <span class="title">parse</span><span class="params">(tokens, comments, options)</span></span>
  ts = <span class="keyword">new</span> TokenStream(tokens, comments, options)
  AST = <span class="keyword">new</span> GrammarRoot(ts)
  <span class="keyword">return</span> AST

<span class="reserved">export</span>s.parse = parse</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The <code>TokenStream</code> class allows easy navigation through the array of tokens, keeping track of line numbers and comments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">TokenStream</span></span><span class="function">
  <span class="keyword">method</span> <span class="title">initialize</span><span class="params">(tokens, comments, options)</span></span>
    me.tokens = tokens
    me.comments = comments
    me.options = options
    me.goto_token <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Go to the next token and return it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function">  <span class="keyword">method</span> <span class="title">next</span><span class="params">()</span></span>
    <span class="keyword">return</span> me.goto_token me.index+<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Go back one token and return it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function">  <span class="keyword">method</span> <span class="title">prev</span><span class="params">()</span></span>
    <span class="keyword">return</span> me.goto_token me.index-<span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Return the next token but stay at the current location in the stream.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function">  <span class="keyword">method</span> <span class="title">peek</span><span class="params">(delta_index)</span></span>
    me.goto_token me.index + delta_index
    token = me.current
    me.goto_token me.index - delta_index
    <span class="keyword">return</span> token</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Go to a specific token. Generally this is not called directly; it is used by <code>next</code>, <code>prev</code>, and <code>peek</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function">  <span class="keyword">method</span> <span class="title">goto_token</span><span class="params">(index)</span></span>
    me.index = index</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Return an <code>EOF</code> token if we ran out of tokens.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> me.index &gt; me.tokens.length - <span class="number">1</span>
      me.current = {<span class="attribute">type</span>: <span class="string">'EOF'</span>, <span class="attribute">text</span>: <span class="string">''</span>, <span class="attribute">line</span>: <span class="number">0</span>, <span class="attribute">value</span>: <span class="string">''</span>}
    <span class="keyword">else</span> <span class="keyword">if</span> me.index &lt; <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Actually error out if we try to read before the beginning of the file. This aborts compilation with a compiler error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">throw</span> <span class="string">'Parser Error: tried to read before beginning of file'</span>
    <span class="keyword">else</span>
      me.current = me.tokens[me.index]</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Utility properties for the parser nodes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    me.type = me.current.type
    me.text = me.current.text
    me.<span class="keyword">value</span> = me.current.<span class="keyword">value</span>
    me.line = me.current.line
    <span class="keyword">return</span> me.current</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
